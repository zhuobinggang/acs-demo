<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>数聚智能门禁信息管理系统-用户管理</title>
    <meta name="keywords" content="Bootstrap模版,Bootstrap模版下载,Bootstrap教程,Bootstrap中文"/>
    <meta name="description" content="站长素材提供Bootstrap模版,Bootstrap教程,Bootstrap中文翻译等相关Bootstrap插件下载"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!-- basic styles -->

    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="assets/css/font-awesome.min.css"/>

    <!--[if IE 7]>
    <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css"/>
    <![endif]-->

    <!-- page specific plugin styles -->

    <!-- fonts -->

    <!--<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300"/>-->

    <!-- ace styles -->

    <link rel="stylesheet" href="assets/css/ace.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-rtl.min.css"/>
    <link rel="stylesheet" href="assets/css/ace-skins.min.css"/>

    <!-- jquery plugin styles -->
    <link rel="stylesheet" href="assets/css/jquery.dataTables.css"/>

    <!--[if lte IE 8]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->
    <link rel="stylesheet" href="css/acs.css"/>

    <!-- inline styles related to this page -->

    <!-- ace settings handler -->

    <script src="assets/js/ace-extra.min.js"></script>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->

    <!--[if lt IE 9]>
    <script src="assets/js/html5shiv.js"></script>
    <script src="assets/js/respond.min.js"></script>
    <![endif]-->

    <!--Js tree-->
    <link href="https://cdn.bootcss.com/jstree/3.3.4/themes/default/style.min.css" rel="stylesheet">
</head>

<body>
<div class="navbar navbar-default" id="navbar">
    <script type="text/javascript">
        try {
            ace.settings.check('navbar', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="navbar-container" id="navbar-container">
        <div class="navbar-header pull-left">
            <a href="#" class="navbar-brand">
                <small>Accudata 数聚智能门禁信息管理系统</small>
            </a><!-- /.brand -->
        </div><!-- /.navbar-header -->

        <div class="navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <li class="purple">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="icon-bell-alt icon-animated-bell"></i>
                        <span class="badge badge-important">8</span>
                    </a>

                    <ul class="pull-right dropdown-navbar navbar-pink dropdown-menu dropdown-caret dropdown-close">
                        <li class="dropdown-header">
                            <i class="icon-warning-sign"></i>
                            8条报警信息
                        </li>
                        <li>
                            <a href="#">
                                <div class="clearfix">
                                			<span class="pull-left">
                                    			<i class="btn btn-xs no-hover btn-pink icon-comment"></i>
                                    			超时未关闭..
											</span>
                                    <span class="pull-right badge badge-info">2</span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <div class="clearfix">
                                			<span class="pull-left">
                                    			<i class="btn btn-xs no-hover btn-pink icon-user"></i>
                                    				消防报警
											</span>
                                    <span class="pull-right badge badge-info">2</span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <div class="clearfix">
                                			<span class="pull-left">
                                    			<i class="btn btn-xs no-hover btn-success icon-shopping-cart"></i>
                                  				  红外报警
                               				 </span>
                                    <span class="pull-right badge badge-success">2</span>
                                </div>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <div class="clearfix">
                               				<span class="pull-left">
                                  				 <i class="btn btn-xs no-hover btn-info icon-twitter"></i>
                                    			门磁报警
                              				</span>
                                    <span class="pull-right badge badge-info">2</span>
                                </div>
                            </a>
                        </li>

                        <li>
                            <a href="#">
                                查看所有报警信息
                                <i class="icon-arrow-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="green">
                    <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                        <i class="icon-envelope icon-animated-vertical"></i>
                        <span class="badge badge-success">5</span>
                    </a>

                    <ul class="pull-right dropdown-navbar dropdown-menu dropdown-caret dropdown-close">
                        <li class="dropdown-header">
                            <i class="icon-envelope-alt"></i>
                            5 条消息
                        </li>

                        <li>
                            <a href="#">
										<span class="msg-body">
											<span class="msg-title">
												<span class="blue">系统通知:</span>
												不知道写啥 ...
											</span>
											<span class="msg-time">
												<i class="icon-time"></i>
												<span>2017-8-31 17:30:30</span>
											</span>
										</span>
                            </a>
                        </li>

                        <li>
                            <a href="#">
										<span class="msg-body">
											<span class="msg-title">
												<span class="blue">系统通知:</span>
												不知道写啥 ...
											</span>
											<span class="msg-time">
												<i class="icon-time"></i>
												<span>2017-8-30 17:30:30</span>
											</span>
										</span>
                            </a>
                        </li>

                        <li>
                            <a href="#">
										<span class="msg-body">
											<span class="msg-title">
												<span class="blue">系统通知:</span>
												不知道写啥 ...
											</span>
											<span class="msg-time">
												<i class="icon-time"></i>
												<span>2017-8-29 17:30:30</span>
											</span>
										</span>
                            </a>
                        </li>

                        <li>
                            <a href="inbox.html">
                                查看所有消息
                                <i class="icon-arrow-right"></i>
                            </a>
                        </li>
                    </ul>
                </li>

                <li class="light-blue">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<span class="user-info">
									<small>欢迎,</small>
									用户名
								</span>

                        <i class="icon-caret-down"></i>
                    </a>

                    <ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="#">
                                <i class="icon-cog"></i>
                                修改密码
                            </a>
                        </li>

                        <li>
                            <a href="acs-user-profile.html">
                                <i class="icon-user"></i>
                                个人信息
                            </a>
                        </li>

                        <li class="divider"></li>

                        <li>
                            <a href="#">
                                <i class="icon-off"></i>
                                退出
                            </a>
                        </li>
                    </ul>
                </li>
            </ul><!-- /.ace-nav -->
        </div><!-- /.navbar-header -->
    </div><!-- /.container -->
</div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>

    <div class="main-container-inner">
        <a class="menu-toggler" id="menu-toggler" href="#">
            <span class="menu-text"></span>
        </a>

        <div class="sidebar" id="sidebar">
            <script type="text/javascript">
                try {
                    ace.settings.check('sidebar', 'fixed')
                } catch (e) {
                }
            </script>

            <ul class="nav nav-list">
                <!-- terminal admin begin -->
                <li class="">
                    <a href="#" class="dropdown-toggle">
                        <i class="icon-lock"></i>
                        <span class="menu-text"> 门禁监控 </span>
                        <b class="arrow icon-angle-down"></b>
                    </a>
                    <ul class="submenu">
                        <li class="">
                            <a href="acs-map.html">
                                <i class="icon-map-marker"></i>
                                <span class="menu-text"> 电子地图 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-monitor.html">
                                <i class="icon-tags"></i>
                                <span class="menu-text"> 监控视图 </span>
                            </a>
                        </li>

                    </ul>
                </li>
                <!-- terminal admin end -->
                <!-- community admin begin -->
                <li class="">
                    <a href="#" class="dropdown-toggle">
                        <i class="icon-cloud"></i>
                        <span class="menu-text"> 门禁管理 </span>
                        <b class="arrow icon-angle-down"></b>
                    </a>
                    <ul class="submenu">
                        <li class="">
                            <a href="acs-terminal.html">
                                <i class="icon-th-list"></i>
                                <span class="menu-text">  终端管理 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-building.html">
                                <i class="icon-building"></i>
                                <span class="menu-text"> 楼宇管理 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-room.html">
                                <i class="icon-home"></i>
                                <span class="menu-text">  房间管理 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-resident.html">
                                <i class="icon-user"></i>
                                <span class="menu-text"> 住户管理 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-card.html">
                                <i class="icon-credit-card"></i>
                                <span class="menu-text"> 卡片管理 </span>
                            </a>
                        </li>
                    </ul>
                </li>
                <!-- community admin end -->
                <!-- system admin begin -->
                <li class="active open">
                    <a href="#" class="dropdown-toggle">
                        <i class="icon-cogs"></i>
                        <span class="menu-text"> 系统管理 </span>
                        <b class="arrow icon-angle-down"></b>
                    </a>
                    <ul class="submenu">
                        <li class="">
                            <a href="acs-user.html">
                                <i class="icon-user"></i>
                                <span class="menu-text"> 用户管理 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-role.html">
                                <i class="icon-male"></i>
                                <span class="menu-text"> 角色管理 </span>
                            </a>
                        </li>
                        <li class="active">
                            <a href="acs-organization.html">
                                <i class="icon-group"></i>
                                <span class="menu-text"> 机构管理 </span>
                            </a>
                        </li>
                        <li class="">
                            <a href="acs-authority.html">
                                <i class="icon-gear"></i>
                                <span class="menu-text"> 权限管理 </span>
                            </a>
                        </li>
                    </ul>
                </li>
                <!-- system admin end -->
            </ul><!-- /.nav-list -->

            <div class="sidebar-collapse" id="sidebar-collapse">
                <i class="icon-double-angle-left" data-icon1="icon-double-angle-left"
                   data-icon2="icon-double-angle-right"></i>
            </div>

            <script type="text/javascript">
                try {
                    ace.settings.check('sidebar', 'collapsed')
                } catch (e) {
                }
            </script>
        </div>

        <div class="main-content">
            <div class="breadcrumbs" id="breadcrumbs">
                <script type="text/javascript">
                    try {
                        ace.settings.check('breadcrumbs', 'fixed')
                    } catch (e) {
                    }
                </script>

                <ul class="breadcrumb">
                    <li>
                        系统管理
                    </li>
                    <li class="active">机构管理</li>
                </ul><!-- .breadcrumb -->

            </div>

            <div class="page-content">
                <div class="row">
                    <div class="col-xs-12">
                        <!-- PAGE CONTENT BEGINS -->
                        <div style="margin-top: 20px; font-size: 12px;">
                            <table style="width:100%">
                                <tr>
                                    <td style="padding:3px;" id="f_user_s">
                                        <form class="form-search">
                                            <div class="row">
                                                <!--<div class="col-xs-12 col-sm-8">-->
                                                <div style="width: 300px;">
                                                    <div class="input-group">
                                                        <input type="text" class="form-control search-query"
                                                               placeholder="机构名称" id="search_bar"/>
                                                        <span class="input-group-btn">
                                                    				<button type="button" class="btn btn-purple btn-sm"
                                                                            onclick="search()">
                                                        				查询
                                                       					<i class="icon-search icon-on-right bigger-110"></i>
                                                    				</button>
                                               					</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </td>
                                    <td align="right" style="padding-right: 3px;" id="f_user_more">
                                        <!--<button class="btn btn-sm btn-primary">分配权限</button>-->
                                        <button class="btn btn-sm btn-primary" onclick="assignGroup()">分配管辖群组
                                        </button>
                                        <button class="btn btn-sm btn-primary" onclick="addOrganization()">添加
                                        </button>
                                        <button class="btn btn-sm btn-primary" onclick="updateOrganization()">修改
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteOrganization()">删除</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div style="margin-top: 20px; font-size: 12px;">
                            <table id="userTable" class="nowrap dataTable hover display cell-border">
                                <!--<thead>-->
                                <!--<tr>-->
                                <!--<td style="text-align: center;">id</td>-->
                                <!--<td style="text-align: center;">角色名称</td>-->
                                <!--<td style="text-align: center;">所属机构</td>-->
                                <!--<td style="text-align: center;">备注信息</td>-->
                                <!--<td style="text-align: center;">状态</td>-->
                                <!--<td style="text-align: center;">创建日期</td>-->
                                <!--</tr>-->
                                <!--</thead>-->
                            </table>
                        </div>
                        <!-- PAGE CONTENT ENDS -->
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.page-content -->
        </div><!-- /.main-content -->

    </div><!-- /.main-container-inner -->

    <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="icon-double-angle-up icon-only bigger-110"></i>
    </a>
</div><!-- /.main-container -->

<!--add-product modal start-->
<div class="modal fade" id="modal-add-organization" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 700px;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title">添加机构</h5>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="frm-add-organization">
                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">机构类型</label>
                        <div class="col-sm-8">
                            <select name="organizationtypeid">
                                <!--<option value="volvo">小区/建筑群</option>-->
                                <!--<option value="saab">居委会/村委会</option>-->
                                <!--<option value="opel">公安局/派出所</option>-->
                                <!--<option value="opel">海辰分公司/部门</option>-->
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">机构名称</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control focus" name="name" placeholder="机构名称"
                                   required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">管辖群组</label>
                        <div class="col-sm-8">
                            <input type="text" disabled class="form-control focus" name="groupIdList" placeholder="选择群组"
                                   required="required">
                        </div>
                        <div class="col-sm-2">
                            <a href="#modal-select-community" data-toggle="modal">选择群组</a>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">详细地址</label>
                        <div class="col-sm-8">
                            <input type="url" class="form-control" name="address" id="detailAddress"
                                   placeholder="">
                        </div>
                        <div class="col-sm-2">
                            <a onclick="selectAddress()" href="#modal-select-address" data-toggle="modal">地图选址</a>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">联系电话</label>
                        <div class="col-sm-8">
                            <input type="url" class="form-control" name="phone"
                                   placeholder="">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">备注信息</label>
                        <div class="col-sm-8">
                            <input type="url" class="form-control" name="remark"
                                   placeholder="">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-10">
                            <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal"
                                    onclick="confirmAddOrganization()">确认
                            </button>
                            <img class="hidden processing" src="img/processing.gif"/>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div><!--add-product modal end-->
<div class="modal fade" id="modal-modify" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 700px;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title">修改机构</h5>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="frm-modify-organization">
                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">机构类型</label>
                        <div class="col-sm-8">
                            <select name="organizationtypeid">
                                <!--<option value="volvo">小区/建筑群</option>-->
                                <!--<option value="saab">居委会/村委会</option>-->
                                <!--<option value="opel">公安局/派出所</option>-->
                                <!--<option value="opel">海辰分公司/部门</option>-->
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">机构名称</label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control focus" name="name" placeholder="机构名称"
                                   required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">管辖群组</label>
                        <div class="col-sm-8">
                            <input type="text" disabled class="form-control focus" name="groupIdList" placeholder="选择群组"
                                   required="required">
                        </div>
                        <div class="col-sm-2">
                            <a href="#modal-select-community" data-toggle="modal">选择群组</a>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">详细地址</label>
                        <div class="col-sm-8">
                            <input type="url" class="form-control" name="address"
                                   placeholder="">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">备注信息</label>
                        <div class="col-sm-8">
                            <input type="url" class="form-control" name="remark"
                                   placeholder="">
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-10">
                            <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal"
                                    onclick="confirmUpdateOrganization()">确认
                            </button>
                            <img class="hidden processing" src="img/processing.gif"/>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div><!--add-product modal end-->

<div class="modal fade" id="assign-group" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 700px;" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title">修改机构</h5>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" id="frm-assign-group">

                    <div class="form-group">
                        <label class="col-sm-2 control-label no-padding-right">管辖群组</label>
                        <div class="col-sm-8">
                            <input type="text" disabled class="form-control focus" name="groupIdList" placeholder="选择群组"
                                   required="required">
                        </div>
                        <div class="col-sm-2">
                            <a href="#modal-select-community" data-toggle="modal">选择群组</a>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-sm-10">
                            <button type="button" class="btn btn-primary btn-sm" data-dismiss="modal"
                                    onclick="confirmAssignGroup()">确认
                            </button>
                            <img class="hidden processing" src="img/processing.gif"/>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div><!--add-product modal end-->


<!--select add community modal start-->
<div class="modal fade" id="modal-select-community" tabindex="-2" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <!--modal header begins-->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title">分配管辖群组</h5>
            </div>
            <!--modal header ends-->
            <!--modal body begins-->
            <div class="modal-body" style="font-size: 12px;">
                <!--<div>-->
                <!--<input id="searchCommunity" type="text" class="form-control search-query"-->
                <!--style="margin-left: 70px; width: 160px; float: left;" placeholder="社区编号/社区名称/社区地址"/>-->
                <!--<span class="input-group-btn">-->
                <!--<button type="button" class="btn btn-purple btn-sm" onclick="searchCommunity()">-->
                <!--查询-->
                <!--<i class="icon-search icon-on-right bigger-110"></i>-->
                <!--</button>-->
                <!--</span>-->
                <!--</div>-->
                <!--<div>-->
                <!--<table id="communityTable" class="nowrap dataTable hover display cell-border">-->
                <!--</table>-->
                <!--</div>-->
                <div class="widget-box">
                    <!--<div class="widget-header header-color-blue2">-->
                    <!--<h4 class="lighter smaller">选择社区</h4>-->
                    <!--</div>-->

                    <div class="widget-body">
                        <div class="widget-main padding-8">
                            <!--<div id="community_tree" class="tree"></div>-->
                            <div id="organization_group_tree"></div>
                        </div>
                    </div>
                </div>
            </div><!--modal body ends-->
            <div class="modal-footer" style="background-color: white;">
                <button class="btn btn-primary btn-sm" data-dismiss="modal" onclick="selectOGGroup()">提交</button>
            </div>
        </div>
    </div>
</div><!--select community modal end-->

<!-- baidu map modal start -->
<div class="modal fade" id="modal-map-marker" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document" style="width:80%">
        <div class="modal-content">
            <!--modal header begins-->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h5 class="modal-title">地图选址</h5>
            </div>
            <!--modal header ends-->
            <!--modal body begins-->
            <div class="modal-body">
                <div id="map-canvas" style="min-height: 500px; width:100%;"></div>

            </div><!--modal body ends-->

            <div class="form-group" style="min-height: 30px; margin-top:10px">
                <div class="col-sm-10">
                    <button type="button" class="btn btn-primary btn-sm" id="btn-marker-reset">重新定位</button>
                    <button type="button" class="btn btn-primary btn-sm disabled" id="btn-marker-confirm">确认</button>
                    <img class="hidden processing" src="img/processing.gif"/>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- baidu map modal end -->

<!-- basic scripts -->
<script src="https://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery-2.0.3.min.js'>" + "<" + "/script>");
</script>


<script type="text/javascript">
    if ("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
</script>
<!--<script src="assets/js/bootstrap.min.js"></script>-->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="assets/js/typeahead-bs2.min.js"></script>

<!-- page specific plugin scripts -->

<!-- ace scripts -->

<!--<script src="assets/js/fuelux/data/fuelux.tree-sampledata.js"></script>-->
<!--<script src="assets/js/fuelux/fuelux.tree.min.js"></script>-->

<script src="assets/js/fuelux/data/fuelux.tree-sampledata.js"></script>
<script src="assets/js/fuelux/fuelux.tree.min.js"></script>

<!-- other jquery scripts -->
<script src="assets/js/jquery.dataTables.min.js"></script>

<!-- custom scripts -->
<script src="js/acs-util.js"></script>

<script src="assets/js/ace-elements.min.js"></script>
<script src="assets/js/ace.min.js"></script>

<script src="js/communityTreeData.js"></script>

<!--Baidu Map Api-->
<script src="http://api.map.baidu.com/api?v=2.0&ak=zSrwwQpoWFZFa9Rk03iyzT2O"></script>

<!--Confirmation Api-->
<script src="https://cdn.bootcss.com/bootstrap-confirmation/1.0.5/bootstrap-confirmation.js"></script>

<!--JS Tree-->
<script src="https://cdn.bootcss.com/jstree/3.3.4/jstree.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    try {
        ace.settings.check('sidebar', 'collapsed')
    } catch (e) {
    }
    var userTable;//遗留数据
    var organizationTable

    $(function () {
//        getUserList();
        //获取机构列表
        //getOGList()
        getOGListServerSide()

        //填充机构类型列表
        fillOrganizationTypeList()

        //填充管辖区域树
        //community_assign_tree();
        fillOrganizationGroupTree()
    });

    /**
     * 获取用户列表
     */
    function getUserList() {
        var param = {
            type: "get",
            url: "data/organizationList.json",
            successCall: initUserTable,
            errorCall: function () {
                showCommonTip("加载用户列表失败！");
            }
        };
        ajax(param);
    }

    /**
     * 初始化用户列表表格
     */
    function initUserTable(data) {
        userTable = $('#userTable').DataTable({
            "data": data,
            "deferRender": true,
            "bProcessing": true,
            "lengthChange": false,
            "ordering": false,
            "createdRow": function (row, data, dataIndex) {
                $('td', row).attr("class", "text-center");
                $(row).css("cursor", "pointer");
            },
            "language": {
                "url": "assets/js/jquery-dataTables-zh.json"
            },
            "columns": [
                {
                    data: 'uuid', render: function (data, type, row) {
                    return '<input id="ckb_' + data + '" name="userCkb" value="' + data + '" type="checkbox" onclick="checkBoxClick(\'userCkb\',\'all-user-checkbox\')">';
                }
                },
                {title: '机构名称', data: "organization", className: "dt-center",},
                {title: '管辖群组', data: "communities", className: "dt-center",},
                {title: '机构类型', data: "remark", className: "dt-center",},
                {title: '创建日期', data: "ctime", className: "dt-center",},
//                {
//                    title: '创建日期', data: "ctime",className: "dt-center", render: function (data, type, row) {
//                    return new Date(data).toString("yyyy-MM-dd");
//                }
//                },
            ],
            "order": [[1, "asc"]]
        });
    }

    function search() {
        var keyword = $('#inputUserName').val();
        console.log(userTable);
        userTable.search(keyword);
    }

    /**
     * 初始化用户列表表格
     */
    function initUserTable(data) {
        userTable = $('#userTable').DataTable({
            "data": data,
            "deferRender": true,
            "bProcessing": true,
            "lengthChange": false,
            "ordering": false,
            "createdRow": function (row, data, dataIndex) {
                $('td', row).attr("class", "text-center");
                $(row).css("cursor", "pointer");
            },
            "language": {
                "url": "assets/js/jquery-dataTables-zh.json"
            },
            "columns": [
                {
                    title: '<input id="all-user-checkbox" type="checkbox" name="radios" />',
                    data: 'uuid', render: function (data, type, row) {
                    return '<input id="ckb_' + data + '" name="userCkb" value="' + data + '" type="checkbox" onclick="checkBoxClick(\'userCkb\',\'all-user-checkbox\')">';
                }, className: "dt-center",
                },
                {title: '机构名称', data: "organization", className: "dt-center",},
                {title: '机构类型', data: "organizationType", className: "dt-center",},
                {title: '管辖群组', data: "resourceGroup", className: "dt-center",},
                {title: '详细地址', data: "contact", className: "dt-center",},
                {title: '联系电话', data: "phone", className: "dt-center",},
                {title: '备注', data: "remark", className: "dt-center",},

            ],
            "order": [[1, "asc"]]
        });
    }

    function search() {
        var keyword = $('#search_bar').val();
        console.log(userTable);
        userTable.search(keyword).draw();
    }

    //select community begin
    function getCommunityList() {
        var param = {
            type: "get",
            url: "data/communityList.json",
            successCall: initCommunityTable,
            errorCall: function () {
                showCommonTip("加载用户列表失败！");
            }
        };
        ajax(param);
    }

    /**
     * 初始化社区列表
     * @param data
     */
    function initCommunityTable(data) {
        var communityTable = $('#communityTable').DataTable({
            "data": data,
            "deferRender": true,
            "bProcessing": true,
            "lengthChange": false,
            "ordering": false,
            "bRetrieve": true,
            "createdRow": function (row, data, dataIndex) {
                $('td', row).attr("class", "text-center");
                $(row).css("cursor", "pointer");
            },
            "language": {
                "url": "assets/js/jquery-dataTables-zh.json"
            },
            "columns": [
                {
                    data: 'uuid', render: function (data, type, row) {
                    return '<input id="radio_' + data + '" name="communityRadio" value="'
                        + data + '" type="radio">';
                }
                },
                {title: "社区编号", data: "communityCode"},
                {title: '社区名称', data: "communityName"},
                {title: '社区地址', data: "communityAddress", className: "dt-center",},
            ],
            "order": [[1, "asc"]]
        });
    }

    function selectCommunity() {
        $('input[name="communityRadio"]:checked').each(function (i, item) {
//            var parent = $(item).parents("tr")[0];
//            var child = $(parent).children("td")[2];
//            var text = $(child).text();
//            $('#modal-add-building input[name="buildingCommunity"]').val(text);
            $('#modal-select-community').modal("hide");
        });
    }

    //select community end
    //community modal init start
    function community_assign_tree() {
        $('#community_tree').ace_tree({
            dataSource: community_tree_data,
            multiSelect: true,
            loadingHTML: '<div class="tree-loading"><i class="icon-refresh icon-spin blue"></i></div>',
            'open-icon': 'icon-minus',
            'close-icon': 'icon-plus',
            'selectable': true,
            'selected-icon': 'icon-ok',
            'unselected-icon': 'icon-remove'
        });
    }

    //community modal init end


    /**
     * Select address 百度地图API功能
     */
    var door = {
        "uuid": "655bdd7b-2dab-4131-af40-86f25ed85690",
        "community": "宏珠公寓",
        "name": "宏珠公寓东门",
        "code": "4404020010010010101",
        "status": true,
        "terminal": "01234567890001",
        "longitude": 113.606669,
        "latitude": 22.365022
    }
    var map = null
    var newMapPoint = null

    function showMap() {
        if (map) return

        // 百度地图API功能
        map = new BMap.Map("map-canvas");  // 创建Map实例
        map.enableScrollWheelZoom(); // 启用滚轮放大缩小
        map.addControl(new BMap.NavigationControl()); // 左上角，添加默认缩放平移控件


        //Clear all overlays
        map.clearOverlays()

        //Init point
        var point = new BMap.Point(door.longitude, door.latitude);
        var marker = new BMap.Marker(point);
        map.addOverlay(marker);
        map.centerAndZoom(point, 20);

//        var content = "门禁别名：" + door.name;
        var content = "";

        content += "<br/>经度: " + door.longitude;
        content += "<br/>纬度：" + door.latitude;
        addClickHandler(content, marker);
    }

    function addClickHandler(content, marker) {
        marker.addEventListener("click", function (e) {
                openInfo(content, e)
            }
        );
    }

    function openInfo(content, e) {
        var p = e.target;
        var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
        var infoWindow = new BMap.InfoWindow(content, opts);  // 创建信息窗口对象
        map.openInfoWindow(infoWindow, point); //开启信息窗口
    }


    function selectAddress() {
        console.log('Select address click!');
        $("#modal-map-marker").modal('show');
        setTimeout(function () {
            showMap();
        }, 200);
    }

    function reMarkOnMap(e) {
        map.clearOverlays()
        newMapPoint = new BMap.Point(e.point.lng, e.point.lat);
        var marker = new BMap.Marker(newMapPoint);
        map.addOverlay(marker);
    }

    //重新定位
    $('#btn-marker-reset').click(function () {
        $('#btn-marker-confirm').removeClass('disabled');
        map.addEventListener("click", reMarkOnMap);
    });

    //Confirm map point change
    $('#btn-marker-confirm').confirmation({
        title: "请确认",
        animation: true,
        placement: 'top',
//                    singleton: true,
        btnOkIcon: 'icon-ok',
        btnOkLabel: '重新定位',
        btnCancelIcon: 'icon-remove',
        btnCancelLabel: '取消',
        onConfirm: function () {
            console.log('Confirm clicked!')
            //Fill input bar
            fillAddressInput()
            map.removeEventListener("click", reMarkOnMap);
            //修改门禁坐标
            door.latitude = newMapPoint.latitude;
            door.longitude = newMapPoint.longitude;
            $('#btn-marker-confirm').addClass('disabled');
            $('#modal-map-marker').modal('hide');

        },
        onCancel: function () {
            //TODO: marker回到原来的位置
            console.log('取消');
        }
    });

    function fillAddressInput() {
        var point = new BMap.Point(door.longitude, door.latitude)
        var gc = new BMap.Geocoder()
        gc.getLocation(point, function (rs) {
//            var addComp = rs.addressComponents;
//            console.info(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber)
            console.info(rs.address)
            $('#detailAddress').val(rs.address)
        });
    }

    /**
     * 2017/10/23 实际功能实现
     */

    var myData = {
        OGTypes: [],//机构类型列表
        groupList: [],
        checkedIds: [],
    }

    function checkIfUserCheckedThenSave(){
        //Check ids and save them
        var ids = getCheckedBox('userCkb')

        if(ids.length < 1){
            alert('You must check users')
            return false
        }

        //Save checked ids
        myData.checkedIds = ids
        return true
    }

    /**
     * 获取机构列表
     */
    function getOGList() {
        $.ajax({
            url: '/organization/list',
            method: 'GET',
        }).then(function success(res) {
            initUserTable(res.resultData)
        }, function error() {
            alert('获取机构列表失败')
        })
    }
    function getOGListServerSide() {
        organizationTable = $('#userTable').DataTable({
            serverSide: true,
            ajax: '/organization/list',
            "deferRender": true,
            "bProcessing": true,
            "lengthChange": false,
            "ordering": false,
            "createdRow": function (row, data, dataIndex) {
                $('td', row).attr("class", "text-center");
                $(row).css("cursor", "pointer");
            },
            "language": {
                "url": "assets/js/jquery-dataTables-zh.json"
            },
            "columns": [
//                {
//                    title: '<input id="all-user-checkbox" type="checkbox" name="radios" />',
//                    data: 'uuid', render: function (data, type, row) {
//                    return '<input id="ckb_' + data + '" name="userCkb" value="' + data + '" type="checkbox" onclick="checkBoxClick(\'userCkb\',\'all-user-checkbox\')">';
//                }, className: "dt-center",
//                },
//                {title: '用户账号', data: "name", className: "dt-center",},
//                {title: '姓名', data: "username", className: "dt-center",},
//                {title: '性别', data: "sex", className: "dt-center",},
//                {title: '出生日期', data: "birth", className: "dt-center",},
//                {
//                    title: '状态', data: "status", className: "dt-center", render: function (data, type, row) {
//                    if (data == '1') {
//                        return '已启用';
//                    } else {
//                        return '未启用';
//                    }
//                }
//                },
//                {title: '证件号码', data: "idNum", className: "dt-center",},
//                {title: '权限角色', data: "role", className: "dt-center",},
//                {title: '所属机构', data: "resourceGroup", className: "dt-center",},
////                {title: '创建人', data: "createUser", className: "dt-center",},
////                {title: '创建时间', data: "createTime", className: "dt-center",},
                {
                    title: '<input id="all-user-checkbox" type="checkbox" name="radios" />',
                    data: 'uuid', render: function (data, type, row) {
                    return '<input id="ckb_' + data + '" name="userCkb" value="' + data + '" type="checkbox" onclick="checkBoxClick(\'userCkb\',\'all-user-checkbox\')">';
                }, className: "dt-center",
                },
                {title: '机构名称', data: "organization", className: "dt-center",},
                {title: '机构类型', data: "organizationType", className: "dt-center",},
                {title: '管辖群组', data: "resourceGroup", className: "dt-center",},
                {title: '详细地址', data: "contact", className: "dt-center",},
                {title: '联系电话', data: "phone", className: "dt-center",},
                {title: '备注', data: "remark", className: "dt-center",},
            ],
            "order": [[1, "asc"]]
        })
    }

    function addOrganization() {
        $('#modal-add-organization').modal('show')
    }

    function fillOrganizationTypeList() {
        $.ajax({
            url: '/organization/typeList',
            method: 'GET',
        }).then(function success(res) {
            myData.OGTypes = res.resultData
            for (item of myData.OGTypes) {
                $('select[name="organizationtypeid"]').append(
                    '<option value="' + item.id + '">' + item.name + '</option>'
                )
            }
        }, function error() {
            alert('请求机构类型列表失败')
        })
    }

    /**
     * 填充管辖群组树
     */
    function fillOrganizationGroupTree() {
        $('#organization_group_tree').jstree({
            plugins: ['checkbox'],
            core: {
                data: function (node, cb) {
                    if (node.id == '#') {
                        requestOGGroup('S', cb)
                    } else {
                        requestOGGroup(node.id, cb)
                    }
                }
            }
        })
    }

    //负责发送ajax请求管辖区域
    function requestOGGroup(id, cb) {
        $.ajax({
            url: '/sysAreas/sysAreaList',
            method: 'GET',
            data: {id: id},
        }).then(function success(res) {
            cb(oGFormat(res.resultData))
        }, function error() {
            alert('请求管辖区域失败')
        })
    }

    //把数据格式化成js tree的数据
    function oGFormat(data) {
        var result = []
        for (item of data) {
            result.push({
                id: item.id,
                text: item.name,
                children: true
            })
        }
        return result
    }

    /**
     * 确认选择管辖群组
     */
    function selectOGGroup() {
        //获取选中的节点并且储存到全局变量中
        var result = []

        var selectedNodes = $('#organization_group_tree').jstree(true).get_top_selected(true)
        for (var node of selectedNodes) {
            result.push({
                id: node.id,
                name: node.text
            })
        }
        myData.groupList = result

        //显示在input框上
        var showText = ''
        for (var item of myData.groupList) {
            showText += (item.name + ',')
        }
        showText = showText.substr(0, showText.length - 1)
        $('input[name="groupIdList"]').val(showText)
    }

    //确认添加
    function confirmAddOrganization() {
        var data = {};

        //对data.groupIdList进行处理
        (function formatFormdata() {
            var formData = $('#frm-add-organization').serializeArray()


            for (var item of formData) {
                data[item.name] = item.value
            }

            var groupIds = []
            for (var item of myData.groupList) {
                groupIds.push(item.id)
            }

            data.groupIdList = groupIds
        })()


        $.ajax({
            traditional: true,
            url: '/organization/add',
            method: 'POST',
            data: data
        }).then(function success(res) {

        },function error() {
            alert('添加机构失败!')
        })
    }

    //修改机构
    function updateOrganization() {
        if(checkIfUserCheckedThenSave()){
            $('#modal-modify').modal('show')
        }
    }

    //确认修改
    function confirmUpdateOrganization() {
        var data = {};

        //对data.groupIdList进行处理
        (function formatFormdata() {
            var formData = $('#frm-modify-organization').serializeArray()


            for (var item of formData) {
                data[item.name] = item.value
            }

            var groupIds = []
            for (var item of myData.groupList) {
                groupIds.push(item.id)
            }

            data.groupIdList = groupIds
            data.ids = myData.checkedIds
        })()


        $.ajax({
            traditional: true,
            url: '/organization/update',
            method: 'POST',
            data: data
        }).then(function success(res) {

        },function error() {
            alert('添加机构失败!')
        })
    }

    /**
     * 分配管辖群组
     */
    function assignGroup() {
        if(checkIfUserCheckedThenSave()){
            $('#assign-group').modal('show')
        }
    }
    function confirmAssignGroup(){
//        $('#frm-assign-group').serialize()
        var groupIds = []
        for(var item of myData.groupList){
            groupIds.push(item.id)
        }

        $.ajax({
            traditional: true,
            url: '/organization/setGroup',
            data: {groupIdList: groupIds,ids: myData.checkedIds},
            method: 'POST',
        }).then(function success(res) {

        },function error() {
            alert('分配管辖群组失败')
        })
    }

    function deleteOrganization() {
        if(checkIfUserCheckedThenSave()){
            $.ajax({
                traditional: true,
                url: '/organization/delete',
                data: {ids: myData.checkedIds},
                method: 'POST',
            }).then(function success() {

            },function error() {
                alert('删除失败!')
            })
        }
    }
</script>
</body>
</html>
